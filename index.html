<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document - NotePad</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #1e1e1e 0%, #2d2d2d 100%);
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .top-bar {
            background: linear-gradient(180deg, #2d2d2d 0%, #252525 100%);
            height: 56px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            border-bottom: 1px solid #404040;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }

        .doc-title {
            color: #ffffff;
            font-size: 15px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .doc-title input {
            background: rgba(255,255,255,0.05);
            border: 1px solid transparent;
            color: white;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 14px;
            transition: all 0.3s;
        }

        .doc-title input:hover {
            border-color: #4a4a4a;
            background: rgba(255,255,255,0.08);
        }

        .doc-title input:focus {
            outline: none;
            border-color: #0078d4;
            background: rgba(0,120,212,0.1);
            box-shadow: 0 0 0 3px rgba(0,120,212,0.1);
        }

        .top-bar-right {
            display: flex;
            gap: 10px;
        }

        .top-btn {
            background: linear-gradient(180deg, #3a3a3a 0%, #2d2d2d 100%);
            border: 1px solid #4a4a4a;
            color: #e0e0e0;
            padding: 8px 16px;
            font-size: 12px;
            cursor: pointer;
            border-radius: 6px;
            transition: all 0.3s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .top-btn:hover {
            background: linear-gradient(180deg, #4a4a4a 0%, #3a3a3a 100%);
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }

        .top-btn:active {
            transform: translateY(0);
            box-shadow: 0 1px 2px rgba(0,0,0,0.2);
        }

        .menu-bar {
            background: linear-gradient(180deg, #2a2a2a 0%, #252525 100%);
            display: flex;
            padding: 0 16px;
            border-bottom: 1px solid #3a3a3a;
            height: 44px;
        }

        .menu-item {
            color: #e0e0e0;
            padding: 10px 18px;
            font-size: 13px;
            background: transparent;
            border: none;
            cursor: pointer;
            border-radius: 6px;
            transition: all 0.3s;
            position: relative;
        }

        .menu-item:hover {
            background: rgba(255,255,255,0.08);
            color: #ffffff;
        }

        .menu-item.active {
            background: linear-gradient(180deg, #0078d4 0%, #0066b8 100%);
            color: #ffffff;
            box-shadow: 0 2px 6px rgba(0,120,212,0.3);
        }

        /* Document Tabs System */
        .tabs-bar {
            background: linear-gradient(180deg, #252525 0%, #1e1e1e 100%);
            display: flex;
            align-items: center;
            border-bottom: 1px solid #3a3a3a;
            padding: 6px 12px;
            overflow-x: auto;
            max-height: 48px;
            box-shadow: inset 0 -1px 0 rgba(255,255,255,0.05);
        }

        .tabs-container {
            display: flex;
            gap: 4px;
            flex: 1;
            overflow-x: auto;
            scrollbar-width: thin;
        }

        .tabs-container::-webkit-scrollbar {
            height: 6px;
        }

        .tabs-container::-webkit-scrollbar-track {
            background: rgba(0,0,0,0.2);
            border-radius: 3px;
        }

        .tabs-container::-webkit-scrollbar-thumb {
            background: rgba(255,255,255,0.2);
            border-radius: 3px;
        }

        .doc-tab {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 16px;
            background: rgba(255,255,255,0.05);
            border: 1px solid transparent;
            border-radius: 8px 8px 0 0;
            cursor: pointer;
            white-space: nowrap;
            min-width: 140px;
            max-width: 220px;
            transition: all 0.3s;
            position: relative;
        }

        .doc-tab:hover {
            background: rgba(255,255,255,0.1);
            border-color: rgba(255,255,255,0.1);
        }

        .doc-tab.active {
            background: linear-gradient(180deg, #1a1a1a 0%, #0f0f0f 100%);
            border-color: #0078d4;
            border-bottom-color: transparent;
            box-shadow: 0 -2px 8px rgba(0,120,212,0.2);
        }

        .doc-tab.active::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, #0078d4 0%, #00bcf2 100%);
            border-radius: 2px 2px 0 0;
        }

        .tab-title {
            color: #b0b0b0;
            font-size: 12px;
            flex: 1;
            overflow: hidden;
            text-overflow: ellipsis;
            font-weight: 500;
        }

        .doc-tab.active .tab-title {
            color: #ffffff;
        }

        .tab-close {
            color: #888;
            font-size: 18px;
            padding: 2px 6px;
            border-radius: 4px;
            transition: all 0.3s;
            line-height: 1;
        }

        .tab-close:hover {
            background: #ff4444;
            color: white;
            box-shadow: 0 2px 4px rgba(255,68,68,0.3);
        }

        .new-tab-btn {
            background: linear-gradient(180deg, #3a3a3a 0%, #2d2d2d 100%);
            border: 1px solid #4a4a4a;
            color: #e0e0e0;
            padding: 6px 14px;
            font-size: 18px;
            cursor: pointer;
            border-radius: 6px;
            margin-left: 8px;
            transition: all 0.3s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .new-tab-btn:hover {
            background: linear-gradient(180deg, #0078d4 0%, #0066b8 100%);
            border-color: #0078d4;
            transform: scale(1.1);
            box-shadow: 0 4px 8px rgba(0,120,212,0.3);
        }

        .ribbon {
            background: linear-gradient(180deg, #2a2a2a 0%, #252525 100%);
            padding: 10px 20px;
            border-bottom: 1px solid #3a3a3a;
            overflow-x: auto;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        }

        .ribbon-content {
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        .ribbon-group {
            display: flex;
            gap: 6px;
            padding: 0 16px;
            border-right: 1px solid rgba(255,255,255,0.1);
        }

        .ribbon-group:last-child {
            border-right: none;
        }

        .ribbon-btn {
            background: linear-gradient(180deg, #3a3a3a 0%, #2d2d2d 100%);
            border: 1px solid #4a4a4a;
            color: #e0e0e0;
            padding: 8px 14px;
            font-size: 13px;
            cursor: pointer;
            border-radius: 6px;
            white-space: nowrap;
            transition: all 0.3s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .ribbon-btn:hover {
            background: linear-gradient(180deg, #4a4a4a 0%, #3a3a3a 100%);
            border-color: #5a5a5a;
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }

        .ribbon-btn:active {
            transform: translateY(0);
            box-shadow: 0 1px 2px rgba(0,0,0,0.2);
        }

        .ribbon-btn.active {
            background: linear-gradient(180deg, #0078d4 0%, #0066b8 100%);
            border-color: #0078d4;
            box-shadow: 0 2px 8px rgba(0,120,212,0.4);
        }

        select {
            background: linear-gradient(180deg, #3a3a3a 0%, #2d2d2d 100%);
            border: 1px solid #4a4a4a;
            color: #e0e0e0;
            padding: 7px 10px;
            font-size: 12px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        select:hover {
            background: linear-gradient(180deg, #4a4a4a 0%, #3a3a3a 100%);
            border-color: #5a5a5a;
        }

        select:focus {
            outline: none;
            border-color: #0078d4;
            box-shadow: 0 0 0 3px rgba(0,120,212,0.2);
        }

        input[type="color"] {
            width: 36px;
            height: 32px;
            border: 1px solid #4a4a4a;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        input[type="color"]:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }

        .main-content {
            flex: 1;
            overflow-y: auto;
            background: linear-gradient(135deg, #1a1a1a 0%, #0f0f0f 100%);
            display: flex;
            justify-content: center;
            padding: 32px;
        }

        .pages-container {
            width: 100%;
            max-width: 850px;
        }

        .page {
            background: #ffffff;
            width: 100%;
            min-height: 1100px;
            padding: 96px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.6);
            margin-bottom: 30px;
            position: relative;
            border-radius: 4px;
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .page:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 40px rgba(0,0,0,0.7);
        }

        .page:last-child {
            margin-bottom: 0;
        }

        .page-content {
            outline: none;
            font-family: Calibri, Arial, sans-serif;
            font-size: 11pt;
            line-height: 1.6;
            color: #000000;
            min-height: 900px;
        }

        .page-number {
            position: absolute;
            bottom: 50px;
            right: 96px;
            color: #999;
            font-size: 10pt;
            user-select: none;
            background: rgba(255,255,255,0.8);
            padding: 4px 8px;
            border-radius: 4px;
        }

        .status-bar {
            background: linear-gradient(180deg, #2d2d2d 0%, #252525 100%);
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            border-top: 1px solid #404040;
            color: #b0b0b0;
            font-size: 11px;
            box-shadow: 0 -2px 8px rgba(0,0,0,0.3);
        }

        .zoom-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .zoom-slider {
            width: 120px;
            height: 4px;
            border-radius: 2px;
            background: #3a3a3a;
            outline: none;
            -webkit-appearance: none;
        }

        .zoom-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background: linear-gradient(180deg, #0078d4 0%, #0066b8 100%);
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .zoom-slider::-webkit-slider-thumb:hover {
            background: linear-gradient(180deg, #1084e0 0%, #0078d4 100%);
            transform: scale(1.2);
        }

        /* Light Theme */
        body.light-theme {
            background: #f0f0f0;
        }

        body.light-theme .top-bar,
        body.light-theme .menu-bar,
        body.light-theme .ribbon,
        body.light-theme .status-bar {
            background: #ffffff;
            border-color: #d0d0d0;
        }

        body.light-theme .menu-item,
        body.light-theme .ribbon-btn,
        body.light-theme .top-btn,
        body.light-theme .doc-title,
        body.light-theme .doc-title input {
            color: #1a1a1a;
        }

        body.light-theme .main-content {
            background: #e5e5e5;
        }

        body.light-theme select {
            background: #ffffff;
            border-color: #d0d0d0;
            color: #1a1a1a;
        }

        /* Find/Replace Dialog */
        .dialog {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(180deg, #2d2d2d 0%, #252525 100%);
            border: 1px solid #404040;
            border-radius: 12px;
            padding: 24px;
            z-index: 1000;
            min-width: 420px;
            box-shadow: 0 12px 48px rgba(0,0,0,0.6);
        }

        .dialog.show {
            display: block;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translate(-50%, -45%);
            }
            to {
                opacity: 1;
                transform: translate(-50%, -50%);
            }
        }

        .dialog-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.6);
            backdrop-filter: blur(4px);
            z-index: 999;
        }

        .dialog-overlay.show {
            display: block;
            animation: fadeIn 0.3s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .dialog h3 {
            color: #ffffff;
            margin-bottom: 20px;
            font-size: 18px;
            font-weight: 600;
        }

        .dialog input[type="text"] {
            width: 100%;
            padding: 10px 14px;
            background: rgba(255,255,255,0.05);
            border: 1px solid #4a4a4a;
            color: #e0e0e0;
            border-radius: 8px;
            margin-bottom: 12px;
            transition: all 0.3s;
            font-size: 13px;
        }

        .dialog input[type="text"]:focus {
            outline: none;
            border-color: #0078d4;
            background: rgba(0,120,212,0.1);
            box-shadow: 0 0 0 3px rgba(0,120,212,0.2);
        }

        .dialog-buttons {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 20px;
        }

        .dialog-btn {
            padding: 10px 20px;
            background: linear-gradient(180deg, #3a3a3a 0%, #2d2d2d 100%);
            border: 1px solid #4a4a4a;
            color: #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 13px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .dialog-btn:hover {
            background: linear-gradient(180deg, #4a4a4a 0%, #3a3a3a 100%);
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }

        .dialog-btn.primary {
            background: linear-gradient(180deg, #0078d4 0%, #0066b8 100%);
            border-color: #0078d4;
        }

        .dialog-btn.primary:hover {
            background: linear-gradient(180deg, #1084e0 0%, #0078d4 100%);
            box-shadow: 0 4px 12px rgba(0,120,212,0.4);
        }

        /* Table styles */
        .page-content table {
            border-collapse: collapse;
            width: 100%;
            margin: 10px 0;
        }

        .page-content table td, .page-content table th {
            border: 1px solid #333;
            padding: 8px;
            min-width: 80px;
        }

        .page-content table th {
            background: #f0f0f0;
            font-weight: bold;
        }

        /* Image manipulation styles */
        .page-content img {
            max-width: 100%;
            height: auto;
            margin: 10px 0;
            cursor: move;
        }

        .page-content img.selected {
            outline: 2px solid #0078d4;
            outline-offset: 2px;
        }

        .image-wrapper {
            position: relative;
            display: inline-block;
            margin: 10px;
        }

        .image-wrapper.selected {
            outline: 2px solid #0078d4;
        }

        .resize-handle {
            position: absolute;
            width: 10px;
            height: 10px;
            background: #0078d4;
            border: 1px solid white;
            display: none;
        }

        .image-wrapper.selected .resize-handle {
            display: block;
        }

        .resize-handle.nw { top: -5px; left: -5px; cursor: nw-resize; }
        .resize-handle.ne { top: -5px; right: -5px; cursor: ne-resize; }
        .resize-handle.sw { bottom: -5px; left: -5px; cursor: sw-resize; }
        .resize-handle.se { bottom: -5px; right: -5px; cursor: se-resize; }
        .resize-handle.n { top: -5px; left: 50%; margin-left: -5px; cursor: n-resize; }
        .resize-handle.s { bottom: -5px; left: 50%; margin-left: -5px; cursor: s-resize; }
        .resize-handle.w { top: 50%; left: -5px; margin-top: -5px; cursor: w-resize; }
        .resize-handle.e { top: 50%; right: -5px; margin-top: -5px; cursor: e-resize; }

        .image-toolbar {
            position: absolute;
            top: -35px;
            left: 0;
            background: #2d2d2d;
            border: 1px solid #3a3a3a;
            border-radius: 3px;
            padding: 4px;
            display: none;
            z-index: 100;
        }

        .image-wrapper.selected .image-toolbar {
            display: flex;
            gap: 4px;
        }

        .image-toolbar button {
            background: transparent;
            border: 1px solid #4a4a4a;
            color: #e0e0e0;
            padding: 4px 8px;
            font-size: 11px;
            cursor: pointer;
            border-radius: 3px;
        }

        .image-toolbar button:hover {
            background: #3a3a3a;
        }

        @media print {
            body {
                background: white;
            }
            .top-bar, .menu-bar, .ribbon, .status-bar {
                display: none;
            }
            .main-content {
                padding: 0;
                background: white;
            }
            .page {
                page-break-after: always;
                margin-bottom: 0;
                box-shadow: none;
            }
            .page:last-child {
                page-break-after: auto;
            }
        }
    </style>
</head>
<body>
    <div class="top-bar">
        <div class="doc-title">
            <span>üìÑ</span>
            <input type="text" id="docTitle" value="Untitled Document" onchange="updateDocTitle()">
        </div>
        <div class="top-bar-right">
            <button class="top-btn" onclick="autoSave()">üíæ Save</button>
            <button class="top-btn" onclick="exportDocument()">üì• Export</button>
            <button class="top-btn" onclick="showLogin()">Login</button>
        </div>
    </div>

    <div class="menu-bar">
        <button class="menu-item" onclick="changeTab('file')">File</button>
        <button class="menu-item active" onclick="changeTab('home')">Home</button>
        <button class="menu-item" onclick="changeTab('insert')">Insert</button>
        <button class="menu-item" onclick="changeTab('layout')">Layout</button>
        <button class="menu-item" onclick="changeTab('review')">Review</button>
        <button class="menu-item" onclick="changeTab('view')">View</button>
    </div>

    <!-- Document Tabs System -->
    <div class="tabs-bar">
        <div class="tabs-container" id="tabsContainer">
            <div class="doc-tab active" data-tab-id="0" onclick="switchDocument(0)">
                <span class="tab-title">Untitled Document</span>
                <span class="tab-close" onclick="closeTab(event, 0)">‚úï</span>
            </div>
        </div>
        <button class="new-tab-btn" onclick="createNewTab()" title="New Tab">+</button>
    </div>

    <div class="ribbon">
        <!-- FILE TAB -->
        <div class="ribbon-content" id="fileRibbon" style="display: none;">
            <div class="ribbon-group">
                <button class="ribbon-btn" onclick="newDocument()">üìÑ New</button>
                <button class="ribbon-btn" onclick="openDocument()">üìÇ Open</button>
                <button class="ribbon-btn" onclick="autoSave(); alert('Document saved!')">üíæ Save</button>
                <button class="ribbon-btn" onclick="exportDocument()">üì• Export</button>
                <button class="ribbon-btn" onclick="window.print()">üñ®Ô∏è Print</button>
            </div>

            <div class="ribbon-group">
                <button class="ribbon-btn" onclick="showSettings()">‚öôÔ∏è Settings</button>
                <button class="ribbon-btn" onclick="showAbout()">‚ÑπÔ∏è About</button>
            </div>
        </div>

        <!-- HOME TAB -->
        <div class="ribbon-content" id="homeRibbon">
            <div class="ribbon-group">
                <select onchange="applyFormat('fontName', this.value)">
                    <option>Calibri</option>
                    <option>Arial</option>
                    <option>Times New Roman</option>
                    <option>Georgia</option>
                    <option>Courier New</option>
                    <option>Verdana</option>
                    <option>Comic Sans MS</option>
                    <option>Trebuchet MS</option>
                    <option>Arial Black</option>
                    <option>Impact</option>
                    <option>Lucida Console</option>
                    <option>Tahoma</option>
                    <option>Palatino</option>
                    <option>Garamond</option>
                    <option>Bookman</option>
                    <option>Avant Garde</option>
                    <option>Helvetica</option>
                    <option>Segoe UI</option>
                    <option>Roboto</option>
                    <option>Open Sans</option>
                </select>
                
                <select onchange="applyFormat('fontSize', this.value)">
                    <option value="1">8pt</option>
                    <option value="2">10pt</option>
                    <option value="3" selected>11pt</option>
                    <option value="4">12pt</option>
                    <option value="5">14pt</option>
                    <option value="6">18pt</option>
                    <option value="7">24pt</option>
                    <option value="7">28pt</option>
                    <option value="7">32pt</option>
                    <option value="7">36pt</option>
                    <option value="7">48pt</option>
                    <option value="7">72pt</option>
                </select>
            </div>

            <div class="ribbon-group">
                <button class="ribbon-btn" onclick="applyFormat('bold')" id="boldBtn" title="Bold (Ctrl+B)">
                    <strong>B</strong>
                </button>
                <button class="ribbon-btn" onclick="applyFormat('italic')" id="italicBtn" title="Italic (Ctrl+I)">
                    <em>I</em>
                </button>
                <button class="ribbon-btn" onclick="applyFormat('underline')" id="underlineBtn" title="Underline (Ctrl+U)">
                    <u>U</u>
                </button>
                <button class="ribbon-btn" onclick="applyFormat('strikeThrough')" title="Strikethrough">
                    <s>S</s>
                </button>
                <button class="ribbon-btn" onclick="applyFormat('subscript')" title="Subscript">
                    X‚ÇÇ
                </button>
                <button class="ribbon-btn" onclick="applyFormat('superscript')" title="Superscript">
                    X¬≤
                </button>
            </div>

            <div class="ribbon-group">
                <input type="color" id="textColor" value="#000000" onchange="applyFormat('foreColor', this.value)" title="Text Color">
                <input type="color" id="bgColor" value="#ffff00" onchange="applyFormat('hiliteColor', this.value)" title="Highlight">
            </div>

            <div class="ribbon-group">
                <button class="ribbon-btn" onclick="applyFormat('justifyLeft')" title="Align Left">‚ò∞</button>
                <button class="ribbon-btn" onclick="applyFormat('justifyCenter')" title="Center">‚ò∞</button>
                <button class="ribbon-btn" onclick="applyFormat('justifyRight')" title="Align Right">‚ò∞</button>
                <button class="ribbon-btn" onclick="applyFormat('justifyFull')" title="Justify">‚ò∞</button>
            </div>

            <div class="ribbon-group">
                <button class="ribbon-btn" onclick="applyFormat('insertUnorderedList')" title="Bullets">‚Ä¢ List</button>
                <button class="ribbon-btn" onclick="applyFormat('insertOrderedList')" title="Numbering">1. List</button>
                <button class="ribbon-btn" onclick="decreaseIndent()" title="Decrease Indent">‚óÇ</button>
                <button class="ribbon-btn" onclick="increaseIndent()" title="Increase Indent">‚ñ∏</button>
            </div>

            <div class="ribbon-group">
                <button class="ribbon-btn" onclick="applyFormat('undo')" title="Undo (Ctrl+Z)">‚Ü∂</button>
                <button class="ribbon-btn" onclick="applyFormat('redo')" title="Redo (Ctrl+Y)">‚Ü∑</button>
            </div>

            <div class="ribbon-group">
                <button class="ribbon-btn" onclick="showFindReplace()" title="Find & Replace (Ctrl+F)">üîç Find</button>
                <button class="ribbon-btn" onclick="applyFormat('removeFormat')" title="Clear Formatting">üóëÔ∏è</button>
                <button class="ribbon-btn" onclick="formatPainter()" title="Format Painter">üñåÔ∏è</button>
            </div>

            <div class="ribbon-group">
                <button class="ribbon-btn" onclick="changeCase('upper')" title="UPPERCASE">AA</button>
                <button class="ribbon-btn" onclick="changeCase('lower')" title="lowercase">aa</button>
                <button class="ribbon-btn" onclick="changeCase('title')" title="Title Case">Aa</button>
            </div>
        </div>

        <!-- INSERT TAB -->
        <div class="ribbon-content" id="insertRibbon" style="display: none;">
            <div class="ribbon-group">
                <button class="ribbon-btn" onclick="insertPageBreak()">üìÑ Page Break</button>
                <button class="ribbon-btn" onclick="deleteCurrentPage()">üóëÔ∏è Delete Page</button>
                <button class="ribbon-btn" onclick="insertTable()">‚äû Table</button>
                <button class="ribbon-btn" onclick="showImageDialog()">üñºÔ∏è Image</button>
                <button class="ribbon-btn" onclick="insertLink()">üîó Link</button>
            </div>

            <div class="ribbon-group">
                <button class="ribbon-btn" onclick="insertHorizontalRule()">‚ûñ Horizontal Line</button>
                <button class="ribbon-btn" onclick="insertDate()">üìÖ Date/Time</button>
                <button class="ribbon-btn" onclick="insertSymbol()">Œ© Symbol</button>
                <button class="ribbon-btn" onclick="insertTextBox()">üìù Text Box</button>
                <button class="ribbon-btn" onclick="insertFootnote()">üìå Footnote</button>
            </div>
        </div>

        <!-- LAYOUT TAB -->
        <div class="ribbon-content" id="layoutRibbon" style="display: none;">
            <div class="ribbon-group">
                <button class="ribbon-btn" onclick="setMargins('narrow')">üìè Narrow Margins</button>
                <button class="ribbon-btn" onclick="setMargins('normal')">üìè Normal Margins</button>
                <button class="ribbon-btn" onclick="setMargins('wide')">üìè Wide Margins</button>
            </div>

            <div class="ribbon-group">
                <button class="ribbon-btn" onclick="setOrientation('portrait')">üìÑ Portrait</button>
                <button class="ribbon-btn" onclick="setOrientation('landscape')">üìÑ Landscape</button>
            </div>

            <div class="ribbon-group">
                <button class="ribbon-btn" onclick="setLineSpacing(1.0)">1.0 Spacing</button>
                <button class="ribbon-btn" onclick="setLineSpacing(1.5)">1.5 Spacing</button>
                <button class="ribbon-btn" onclick="setLineSpacing(2.0)">2.0 Spacing</button>
            </div>
        </div>

        <!-- REVIEW TAB -->
        <div class="ribbon-content" id="reviewRibbon" style="display: none;">
            <div class="ribbon-group">
                <button class="ribbon-btn" onclick="spellCheck()">‚úì Spell Check</button>
                <button class="ribbon-btn" onclick="wordCount()">üìä Word Count</button>
            </div>

            <div class="ribbon-group">
                <button class="ribbon-btn" onclick="addComment()">üí¨ Comment</button>
                <button class="ribbon-btn" onclick="trackChanges()">üìù Track Changes</button>
            </div>
        </div>

        <!-- VIEW TAB -->
        <div class="ribbon-content" id="viewRibbon" style="display: none;">
            <div class="ribbon-group">
                <button class="ribbon-btn" onclick="toggleTheme()">üåì Theme</button>
                <button class="ribbon-btn" onclick="zoomIn()">üîç+ Zoom In</button>
                <button class="ribbon-btn" onclick="zoomOut()">üîç- Zoom Out</button>
                <button class="ribbon-btn" onclick="resetZoom()">100% Reset</button>
            </div>

            <div class="ribbon-group">
                <button class="ribbon-btn" onclick="fullScreen()">‚õ∂ Full Screen</button>
                <button class="ribbon-btn" onclick="readingMode()">üìñ Reading Mode</button>
            </div>
        </div>
    </div>

    <div class="main-content">
        <div class="pages-container" id="pagesContainer">
            <div class="page" data-page="1">
                <div class="page-content" contenteditable="true" spellcheck="true"></div>
                <div class="page-number">Page 1</div>
            </div>
        </div>
    </div>

    <div class="status-bar">
        <span id="wordCount">0 words | 0 characters</span>
        <span id="pageInfo">Page 1 of 1</span>
        <div class="zoom-controls">
            <button class="ribbon-btn" onclick="zoomOut()">‚àí</button>
            <input type="range" class="zoom-slider" min="50" max="200" value="100" id="zoomSlider" oninput="updateZoom(this.value)">
            <button class="ribbon-btn" onclick="zoomIn()">+</button>
            <span id="zoomLevel">100%</span>
        </div>
    </div>

    <!-- Find/Replace Dialog -->
    <div class="dialog-overlay" id="dialogOverlay" onclick="closeDialogs()"></div>
    <div class="dialog" id="findDialog">
        <h3>Find and Replace</h3>
        <input type="text" id="findText" placeholder="Find...">
        <input type="text" id="replaceText" placeholder="Replace with...">
        <div class="dialog-buttons">
            <button class="dialog-btn" onclick="closeFindReplace()">Cancel</button>
            <button class="dialog-btn" onclick="findNext()">Find Next</button>
            <button class="dialog-btn primary" onclick="replaceAll()">Replace All</button>
        </div>
    </div>

    <!-- Settings Dialog -->
    <div class="dialog" id="settingsDialog">
        <h3>Settings</h3>
        <div style="margin: 15px 0;">
            <label style="display: block; color: #e0e0e0; margin-bottom: 10px;">
                <input type="checkbox" id="autoSaveEnabled" checked onchange="toggleAutoSave()">
                Enable Auto-Save
            </label>
            <label style="display: block; color: #e0e0e0; margin-bottom: 10px;">
                <input type="checkbox" id="spellCheckEnabled" checked onchange="toggleSpellCheck()">
                Enable Spell Check
            </label>
            <label style="display: block; color: #e0e0e0; margin-bottom: 10px;">
                <input type="checkbox" id="showPageNumbers" checked onchange="togglePageNumbers()">
                Show Page Numbers
            </label>
            <label style="display: block; color: #e0e0e0; margin-bottom: 10px;">
                Theme:
                <select id="themeSelect" onchange="changeThemeFromSettings()" style="margin-left: 10px; padding: 5px;">
                    <option value="dark">Dark</option>
                    <option value="light">Light</option>
                </select>
            </label>
        </div>
        <div class="dialog-buttons">
            <button class="dialog-btn primary" onclick="closeSettings()">OK</button>
        </div>
    </div>

    <!-- Image Insert Dialog -->
    <div class="dialog" id="imageDialog">
        <h3>Insert Image</h3>
        <div style="margin: 15px 0;">
            <button class="dialog-btn primary" onclick="insertImageFromDevice()" style="width: 100%; margin-bottom: 10px;">
                üìÅ Upload from Device
            </button>
            <div style="color: #e0e0e0; text-align: center; margin: 10px 0;">- OR -</div>
            <input type="text" id="imageUrlInput" placeholder="Enter image URL..." style="width: 100%; margin-bottom: 10px;">
        </div>
        <div class="dialog-buttons">
            <button class="dialog-btn" onclick="closeImageDialog()">Cancel</button>
            <button class="dialog-btn primary" onclick="insertImageFromUrl()">Insert</button>
        </div>
    </div>

    <!-- Delete Page Confirmation Dialog -->
    <div class="dialog" id="deletePageDialog">
        <h3>Delete Page</h3>
        <p style="color: #e0e0e0; margin: 15px 0;">
            Are you sure you want to delete the current page?
            <br><br>
            <strong>This action cannot be undone.</strong>
        </p>
        <div class="dialog-buttons">
            <button class="dialog-btn" onclick="closeDeletePageDialog()">Cancel</button>
            <button class="dialog-btn" style="background: #d32f2f;" onclick="confirmDeletePage()">Delete Page</button>
        </div>
    </div>

    <!-- File Input for Open and Images -->
    <input type="file" id="fileInput" style="display: none;" accept=".html,.txt" onchange="handleFileOpen(event)">
    <input type="file" id="imageFileInput" style="display: none;" accept="image/*" onchange="handleImageUpload(event)">

    <script>
        // DOCUMENT TAB MANAGEMENT SYSTEM
        let documents = [
            {
                id: 0,
                title: 'Untitled Document',
                pages: ['']
            }
        ];
        let currentDocumentId = 0;
        let nextDocumentId = 1;

        function getCurrentDocument() {
            return documents.find(doc => doc.id === currentDocumentId);
        }

        function saveCurrentDocumentState() {
            const doc = getCurrentDocument();
            if (!doc) return;
            
            doc.title = document.getElementById('docTitle').value;
            doc.pages = [];
            getAllPageContents().forEach(page => {
                doc.pages.push(page.innerHTML);
            });
            
            // Update tab title
            const tab = document.querySelector(`.doc-tab[data-tab-id="${currentDocumentId}"]`);
            if (tab) {
                tab.querySelector('.tab-title').textContent = doc.title;
            }
        }

        function loadDocument(docId) {
            // Save current document first
            saveCurrentDocumentState();
            
            currentDocumentId = docId;
            const doc = getCurrentDocument();
            
            if (!doc) return;
            
            // Update document title
            document.getElementById('docTitle').value = doc.title;
            
            // Load pages
            const container = document.getElementById('pagesContainer');
            container.innerHTML = '';
            
            doc.pages.forEach((content, index) => {
                const pageNum = index + 1;
                const page = document.createElement('div');
                page.className = 'page';
                page.setAttribute('data-page', pageNum);
                page.innerHTML = `
                    <div class="page-content" contenteditable="true" spellcheck="true">${content}</div>
                    <div class="page-number">Page ${pageNum}</div>
                `;
                container.appendChild(page);
                setupPageListeners(page.querySelector('.page-content'));
            });
            
            // Setup image manipulation
            setTimeout(setupImageManipulation, 100);
            
            updateWordCount();
            updatePageCount();
            
            // Update active tab
            document.querySelectorAll('.doc-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            const activeTab = document.querySelector(`.doc-tab[data-tab-id="${docId}"]`);
            if (activeTab) {
                activeTab.classList.add('active');
            }
        }

        function switchDocument(docId) {
            if (docId === currentDocumentId) return;
            loadDocument(docId);
        }

        function createNewTab() {
            const newDoc = {
                id: nextDocumentId++,
                title: 'Untitled Document',
                pages: ['']
            };
            
            documents.push(newDoc);
            
            // Create tab
            const tabsContainer = document.getElementById('tabsContainer');
            const newTab = document.createElement('div');
            newTab.className = 'doc-tab';
            newTab.setAttribute('data-tab-id', newDoc.id);
            newTab.setAttribute('onclick', `switchDocument(${newDoc.id})`);
            newTab.innerHTML = `
                <span class="tab-title">${newDoc.title}</span>
                <span class="tab-close" onclick="closeTab(event, ${newDoc.id})">‚úï</span>
            `;
            
            tabsContainer.appendChild(newTab);
            
            // Switch to new tab
            loadDocument(newDoc.id);
        }

        function closeTab(event, docId) {
            event.stopPropagation();
            
            if (documents.length === 1) {
                alert('Cannot close the last tab. At least one document must remain open.');
                return;
            }
            
            const doc = documents.find(d => d.id === docId);
            if (!doc) return;
            
            // Check if document has content
            const hasContent = doc.pages.some(page => page.trim().length > 0);
            if (hasContent) {
                if (!confirm(`Close "${doc.title}"? Any unsaved changes will be lost.`)) {
                    return;
                }
            }
            
            // Remove document
            documents = documents.filter(d => d.id !== docId);
            
            // Remove tab
            const tab = document.querySelector(`.doc-tab[data-tab-id="${docId}"]`);
            if (tab) {
                tab.remove();
            }
            
            // Switch to another tab if this was the active one
            if (docId === currentDocumentId) {
                const nextDoc = documents[0];
                loadDocument(nextDoc.id);
            }
            
            saveAllDocuments();
        }

        function saveAllDocuments() {
            try {
                // Save current document inline to avoid recursion
                const doc = getCurrentDocument();
                if (doc) {
                    doc.title = document.getElementById('docTitle').value;
                    doc.pages = [];
                    getAllPageContents().forEach(page => {
                        doc.pages.push(page.innerHTML);
                    });
                    
                    // Update tab title
                    const tab = document.querySelector(`.doc-tab[data-tab-id="${currentDocumentId}"]`);
                    if (tab) {
                        tab.querySelector('.tab-title').textContent = doc.title;
                    }
                }
                
                // Save to localStorage
                localStorage.setItem('notepad-all-documents', JSON.stringify(documents));
                localStorage.setItem('notepad-next-id', nextDocumentId);
            } catch(e) {
                console.error('Error saving documents:', e);
            }
        }

        function loadAllDocuments() {
            try {
                const saved = localStorage.getItem('notepad-all-documents');
                if (saved) {
                    documents = JSON.parse(saved);
                    const savedNextId = localStorage.getItem('notepad-next-id');
                    if (savedNextId) {
                        nextDocumentId = parseInt(savedNextId);
                    }
                    
                    // Recreate tabs
                    const tabsContainer = document.getElementById('tabsContainer');
                    tabsContainer.innerHTML = '';
                    
                    documents.forEach(doc => {
                        const tab = document.createElement('div');
                        tab.className = 'doc-tab';
                        tab.setAttribute('data-tab-id', doc.id);
                        tab.setAttribute('onclick', `switchDocument(${doc.id})`);
                        tab.innerHTML = `
                            <span class="tab-title">${doc.title}</span>
                            <span class="tab-close" onclick="closeTab(event, ${doc.id})">‚úï</span>
                        `;
                        tabsContainer.appendChild(tab);
                    });
                    
                    // Load first document
                    if (documents.length > 0) {
                        currentDocumentId = documents[0].id;
                        loadDocument(currentDocumentId);
                    }
                }
            } catch(e) {
                console.error('Error loading documents:', e);
            }
        }

        // EXISTING CODE CONTINUES...
        let currentZoom = 100;
        const MAX_PAGE_HEIGHT = 900;

        function getAllPageContents() {
            return document.querySelectorAll('.page-content');
        }

        function getCurrentPageContent() {
            const selection = window.getSelection();
            if (selection.rangeCount > 0) {
                const range = selection.getRangeAt(0);
                const pageContent = range.commonAncestorContainer.nodeType === 3 
                    ? range.commonAncestorContainer.parentElement.closest('.page-content')
                    : range.commonAncestorContainer.closest('.page-content');
                return pageContent || getAllPageContents()[0];
            }
            return getAllPageContents()[0];
        }

        function applyFormat(cmd, value) {
            try {
                if (value === undefined) value = null;
                document.execCommand(cmd, false, value);
                const pageContent = getCurrentPageContent();
                if (pageContent) pageContent.focus();
                updateButtons();
            } catch(e) {
                console.error('Format error:', e);
            }
        }

        function updateButtons() {
            try {
                const boldBtn = document.getElementById('boldBtn');
                const italicBtn = document.getElementById('italicBtn');
                const underlineBtn = document.getElementById('underlineBtn');
                
                if (boldBtn) boldBtn.classList.toggle('active', document.queryCommandState('bold'));
                if (italicBtn) italicBtn.classList.toggle('active', document.queryCommandState('italic'));
                if (underlineBtn) underlineBtn.classList.toggle('active', document.queryCommandState('underline'));
            } catch(e) {}
        }

        function checkPageOverflow() {
            const pages = document.querySelectorAll('.page');
            const lastPage = pages[pages.length - 1];
            const lastPageContent = lastPage.querySelector('.page-content');
            
            if (lastPageContent && lastPageContent.scrollHeight > MAX_PAGE_HEIGHT) {
                createNewPage();
            }
        }

        function createNewPage() {
            const container = document.getElementById('pagesContainer');
            const pages = container.querySelectorAll('.page');
            const newPageNumber = pages.length + 1;
            
            const newPage = document.createElement('div');
            newPage.className = 'page';
            newPage.setAttribute('data-page', newPageNumber);
            newPage.innerHTML = `
                <div class="page-content" contenteditable="true" spellcheck="true"></div>
                <div class="page-number">Page ${newPageNumber}</div>
            `;
            
            container.appendChild(newPage);
            setupPageListeners(newPage.querySelector('.page-content'));
            updatePageCount();
        }

        function insertPageBreak() {
            const currentPageContent = getCurrentPageContent();
            if (currentPageContent) {
                createNewPage();
                const pages = document.querySelectorAll('.page-content');
                pages[pages.length - 1].focus();
            }
        }

        function updateWordCount() {
            try {
                let totalText = '';
                getAllPageContents().forEach(page => {
                    totalText += page.innerText || '';
                });
                const words = totalText.trim().split(/\s+/).filter(w => w.length > 0).length;
                const chars = totalText.length;
                document.getElementById('wordCount').textContent = `${words} words | ${chars} characters`;
            } catch(e) {}
        }

        function updatePageCount() {
            const pageCount = document.querySelectorAll('.page').length;
            document.getElementById('pageInfo').textContent = `Page ${pageCount} of ${pageCount}`;
        }

        function setupPageListeners(pageContent) {
            pageContent.addEventListener('input', function() {
                updateWordCount();
                checkPageOverflow();
                updateButtons();
                autoSave();
            });

            pageContent.addEventListener('mouseup', updateButtons);
            pageContent.addEventListener('keyup', updateButtons);
            
            pageContent.addEventListener('keydown', function(e) {
                if (e.key === 'Enter') {
                    setTimeout(() => checkPageOverflow(), 10);
                }
            });
        }

        function changeTab(tabName) {
            try {
                document.querySelectorAll('.ribbon-content').forEach(r => {
                    r.style.display = 'none';
                });
                
                const ribbon = document.getElementById(tabName + 'Ribbon');
                if (ribbon) {
                    ribbon.style.display = 'flex';
                }
                
                document.querySelectorAll('.menu-item').forEach(item => {
                    item.classList.remove('active');
                });
                event.target.classList.add('active');
            } catch(e) {}
        }

        // INSERT FEATURES
        function insertTable() {
            const rows = prompt('Number of rows:', '3');
            const cols = prompt('Number of columns:', '3');
            if (rows && cols) {
                let table = '<table><tbody>';
                for (let i = 0; i < rows; i++) {
                    table += '<tr>';
                    for (let j = 0; j < cols; j++) {
                        table += i === 0 ? '<th>Header</th>' : '<td>Cell</td>';
                    }
                    table += '</tr>';
                }
                table += '</tbody></table>';
                applyFormat('insertHTML', table);
            }
        }

        // IMAGE INSERTION
        function showImageDialog() {
            closeDialogs();
            document.getElementById('dialogOverlay').classList.add('show');
            document.getElementById('imageDialog').classList.add('show');
        }

        function closeImageDialog() {
            document.getElementById('dialogOverlay').classList.remove('show');
            document.getElementById('imageDialog').classList.remove('show');
            document.getElementById('imageUrlInput').value = '';
        }

        function insertImageFromDevice() {
            document.getElementById('imageFileInput').click();
        }

        function handleImageUpload(event) {
            const file = event.target.files[0];
            if (file && file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    insertImageWithWrapper(e.target.result);
                    closeImageDialog();
                };
                reader.readAsDataURL(file);
            }
        }

        function insertImageFromUrl() {
            const url = document.getElementById('imageUrlInput').value;
            if (url) {
                insertImageWithWrapper(url);
                closeImageDialog();
            }
        }

        function insertImageWithWrapper(src) {
            const wrapper = `
                <div class="image-wrapper" contenteditable="false">
                    <div class="image-toolbar">
                        <button onclick="rotateImage(this)" title="Rotate">üîÑ</button>
                        <button onclick="flipImage(this, 'h')" title="Flip Horizontal">‚áÑ</button>
                        <button onclick="flipImage(this, 'v')" title="Flip Vertical">‚áÖ</button>
                        <button onclick="deleteImage(this)" title="Delete">üóëÔ∏è</button>
                    </div>
                    <img src="${src}" style="max-width: 400px; height: auto;" draggable="true">
                    <div class="resize-handle nw"></div>
                    <div class="resize-handle n"></div>
                    <div class="resize-handle ne"></div>
                    <div class="resize-handle w"></div>
                    <div class="resize-handle e"></div>
                    <div class="resize-handle sw"></div>
                    <div class="resize-handle s"></div>
                    <div class="resize-handle se"></div>
                </div>
            `;
            applyFormat('insertHTML', wrapper);
            
            // Setup image manipulation after insertion
            setTimeout(setupImageManipulation, 100);
        }

        function setupImageManipulation() {
            const wrappers = document.querySelectorAll('.image-wrapper');
            
            wrappers.forEach(wrapper => {
                const img = wrapper.querySelector('img');
                
                // Click to select
                wrapper.addEventListener('click', function(e) {
                    e.stopPropagation();
                    document.querySelectorAll('.image-wrapper').forEach(w => w.classList.remove('selected'));
                    this.classList.add('selected');
                });
                
                // Drag to move
                img.addEventListener('dragstart', function(e) {
                    e.dataTransfer.setData('text/plain', '');
                });
                
                // Resize handles
                const handles = wrapper.querySelectorAll('.resize-handle');
                handles.forEach(handle => {
                    handle.addEventListener('mousedown', function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        startResize(e, wrapper, this.classList[1]);
                    });
                });
            });
            
            // Click outside to deselect
            document.addEventListener('click', function(e) {
                if (!e.target.closest('.image-wrapper')) {
                    document.querySelectorAll('.image-wrapper').forEach(w => w.classList.remove('selected'));
                }
            });
        }

        let isResizing = false;
        let currentWrapper = null;
        let startX, startY, startWidth, startHeight;

        function startResize(e, wrapper, direction) {
            isResizing = true;
            currentWrapper = wrapper;
            const img = wrapper.querySelector('img');
            
            startX = e.clientX;
            startY = e.clientY;
            startWidth = img.offsetWidth;
            startHeight = img.offsetHeight;
            
            function resize(e) {
                if (!isResizing) return;
                
                const deltaX = e.clientX - startX;
                const deltaY = e.clientY - startY;
                
                let newWidth = startWidth;
                let newHeight = startHeight;
                
                if (direction.includes('e')) {
                    newWidth = startWidth + deltaX;
                }
                if (direction.includes('w')) {
                    newWidth = startWidth - deltaX;
                }
                if (direction.includes('s')) {
                    newHeight = startHeight + deltaY;
                }
                if (direction.includes('n')) {
                    newHeight = startHeight - deltaY;
                }
                
                // Maintain aspect ratio
                if (direction === 'se' || direction === 'nw' || direction === 'ne' || direction === 'sw') {
                    const ratio = startWidth / startHeight;
                    newHeight = newWidth / ratio;
                }
                
                if (newWidth > 50 && newHeight > 50) {
                    img.style.width = newWidth + 'px';
                    img.style.height = newHeight + 'px';
                    img.style.maxWidth = 'none';
                }
            }
            
            function stopResize() {
                isResizing = false;
                document.removeEventListener('mousemove', resize);
                document.removeEventListener('mouseup', stopResize);
            }
            
            document.addEventListener('mousemove', resize);
            document.addEventListener('mouseup', stopResize);
        }

        function rotateImage(btn) {
            const wrapper = btn.closest('.image-wrapper');
            const img = wrapper.querySelector('img');
            const currentRotation = img.style.transform ? parseInt(img.style.transform.replace(/[^0-9-]/g, '')) : 0;
            const newRotation = (currentRotation + 90) % 360;
            img.style.transform = 'rotate(' + newRotation + 'deg)';
        }

        function flipImage(btn, direction) {
            const wrapper = btn.closest('.image-wrapper');
            const img = wrapper.querySelector('img');
            
            if (direction === 'h') {
                const current = img.style.transform || '';
                if (current.includes('scaleX(-1)')) {
                    img.style.transform = current.replace('scaleX(-1)', 'scaleX(1)');
                } else {
                    img.style.transform = current + ' scaleX(-1)';
                }
            } else {
                const current = img.style.transform || '';
                if (current.includes('scaleY(-1)')) {
                    img.style.transform = current.replace('scaleY(-1)', 'scaleY(1)');
                } else {
                    img.style.transform = current + ' scaleY(-1)';
                }
            }
        }

        function deleteImage(btn) {
            if (confirm('Delete this image?')) {
                const wrapper = btn.closest('.image-wrapper');
                wrapper.remove();
            }
        }

        function insertLink() {
            const url = prompt('Enter URL:');
            if (url) {
                applyFormat('createLink', url);
            }
        }

        function insertHorizontalRule() {
            applyFormat('insertHorizontalRule');
        }

        function insertDate() {
            const now = new Date();
            const dateStr = now.toLocaleDateString() + ' ' + now.toLocaleTimeString();
            applyFormat('insertText', dateStr);
        }

        function insertSymbol() {
            const symbols = ['¬©', '¬Æ', '‚Ñ¢', '¬ß', '¬∂', '‚Ä†', '‚Ä°', '‚Ä¢', '¬∞', '¬±', '√ó', '√∑', '‚âà', '‚â†', '‚â§', '‚â•', 'Œ±', 'Œ≤', 'Œ≥', 'œÄ', 'Œ£', '‚àû', '‚Üê', '‚Üí', '‚Üë', '‚Üì', '‚ô†', '‚ô£', '‚ô•', '‚ô¶'];
            const symbol = prompt('Choose symbol:\n' + symbols.join(' ') + '\n\nEnter the symbol:');
            if (symbol) {
                applyFormat('insertText', symbol);
            }
        }

        function insertTextBox() {
            const text = prompt('Enter text for text box:');
            if (text) {
                const textBox = '<div style="border: 2px solid #333; padding: 15px; margin: 10px 0; background: #f9f9f9; border-radius: 5px;">' + text + '</div>';
                applyFormat('insertHTML', textBox);
            }
        }

        function insertFootnote() {
            const footnote = prompt('Enter footnote text:');
            if (footnote) {
                const footnoteMark = '<sup style="color: blue; cursor: pointer;" title="' + footnote + '">[*]</sup>';
                applyFormat('insertHTML', footnoteMark);
            }
        }

        // PAGE DELETION
        let pageToDelete = null;

        function deleteCurrentPage() {
            const pages = document.querySelectorAll('.page');
            if (pages.length <= 1) {
                alert('Cannot delete the last page. Document must have at least one page.');
                return;
            }

            const selection = window.getSelection();
            if (selection.rangeCount > 0) {
                const range = selection.getRangeAt(0);
                const currentPage = range.commonAncestorContainer.nodeType === 3 
                    ? range.commonAncestorContainer.parentElement.closest('.page')
                    : range.commonAncestorContainer.closest('.page');
                
                if (currentPage) {
                    pageToDelete = currentPage;
                    document.getElementById('dialogOverlay').classList.add('show');
                    document.getElementById('deletePageDialog').classList.add('show');
                }
            }
        }

        function closeDeletePageDialog() {
            document.getElementById('dialogOverlay').classList.remove('show');
            document.getElementById('deletePageDialog').classList.remove('show');
            pageToDelete = null;
        }

        function confirmDeletePage() {
            if (pageToDelete) {
                pageToDelete.remove();
                updatePageNumbers();
                updatePageCount();
                closeDeletePageDialog();
            }
        }

        function updatePageNumbers() {
            const pages = document.querySelectorAll('.page');
            pages.forEach((page, index) => {
                const pageNum = index + 1;
                page.setAttribute('data-page', pageNum);
                const pageNumber = page.querySelector('.page-number');
                if (pageNumber) {
                    pageNumber.textContent = 'Page ' + pageNum;
                }
            });
        }

        // CASE CONVERSION
        function changeCase(caseType) {
            const selection = window.getSelection();
            if (selection.toString()) {
                const text = selection.toString();
                let newText = text;
                
                switch(caseType) {
                    case 'upper':
                        newText = text.toUpperCase();
                        break;
                    case 'lower':
                        newText = text.toLowerCase();
                        break;
                    case 'title':
                        newText = text.replace(/\w\S*/g, function(txt) {
                            return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();
                        });
                        break;
                }
                
                applyFormat('insertText', newText);
            } else {
                alert('Please select text to change case.');
            }
        }

        // FORMAT PAINTER
        let copiedFormat = null;

        function formatPainter() {
            const selection = window.getSelection();
            if (selection.rangeCount > 0) {
                const range = selection.getRangeAt(0);
                const element = range.commonAncestorContainer.nodeType === 3 
                    ? range.commonAncestorContainer.parentElement 
                    : range.commonAncestorContainer;
                
                copiedFormat = {
                    fontFamily: window.getComputedStyle(element).fontFamily,
                    fontSize: window.getComputedStyle(element).fontSize,
                    fontWeight: window.getComputedStyle(element).fontWeight,
                    fontStyle: window.getComputedStyle(element).fontStyle,
                    textDecoration: window.getComputedStyle(element).textDecoration,
                    color: window.getComputedStyle(element).color,
                    backgroundColor: window.getComputedStyle(element).backgroundColor
                };
                
                alert('Format copied! Select text and click Format Painter again to apply.');
            } else if (copiedFormat) {
                // Apply format
                const sel = window.getSelection();
                if (sel.rangeCount > 0) {
                    const r = sel.getRangeAt(0);
                    const span = document.createElement('span');
                    span.style.fontFamily = copiedFormat.fontFamily;
                    span.style.fontSize = copiedFormat.fontSize;
                    span.style.fontWeight = copiedFormat.fontWeight;
                    span.style.fontStyle = copiedFormat.fontStyle;
                    span.style.textDecoration = copiedFormat.textDecoration;
                    span.style.color = copiedFormat.color;
                    span.style.backgroundColor = copiedFormat.backgroundColor;
                    
                    r.surroundContents(span);
                    copiedFormat = null;
                }
            } else {
                alert('Please select text to copy format first.');
            }
        }

        // LAYOUT FEATURES
        function setMargins(type) {
            const page = document.querySelector('.page');
            switch(type) {
                case 'narrow':
                    page.style.padding = '48px';
                    break;
                case 'normal':
                    page.style.padding = '96px';
                    break;
                case 'wide':
                    page.style.padding = '144px';
                    break;
            }
        }

        function setOrientation(orientation) {
            const pages = document.querySelectorAll('.page');
            pages.forEach(page => {
                if (orientation === 'landscape') {
                    page.style.width = '1100px';
                    page.style.minHeight = '850px';
                } else {
                    page.style.width = '100%';
                    page.style.minHeight = '1100px';
                }
            });
        }

        function setLineSpacing(spacing) {
            const pageContent = getCurrentPageContent();
            if (pageContent) {
                pageContent.style.lineHeight = spacing;
            }
        }

        function decreaseIndent() {
            applyFormat('outdent');
        }

        function increaseIndent() {
            applyFormat('indent');
        }

        // REVIEW FEATURES
        function spellCheck() {
            const pageContent = getCurrentPageContent();
            if (pageContent) {
                const hasSpellcheck = pageContent.getAttribute('spellcheck') === 'true';
                pageContent.setAttribute('spellcheck', !hasSpellcheck);
                alert(hasSpellcheck ? 'Spell check disabled' : 'Spell check enabled');
            }
        }

        function wordCount() {
            let totalText = '';
            getAllPageContents().forEach(page => {
                totalText += page.innerText || '';
            });
            const words = totalText.trim().split(/\s+/).filter(w => w.length > 0).length;
            const chars = totalText.length;
            const charsNoSpaces = totalText.replace(/\s/g, '').length;
            const sentences = totalText.split(/[.!?]+/).filter(s => s.trim().length > 0).length;
            const paragraphs = totalText.split(/\n\n+/).filter(p => p.trim().length > 0).length;
            
            alert(`Word Count Statistics:\n\nWords: ${words}\nCharacters (with spaces): ${chars}\nCharacters (no spaces): ${charsNoSpaces}\nSentences: ${sentences}\nParagraphs: ${paragraphs}`);
        }

        function addComment() {
            const comment = prompt('Add comment:');
            if (comment) {
                const selection = window.getSelection();
                if (selection.toString()) {
                    const span = document.createElement('span');
                    span.style.backgroundColor = '#ffeb3b';
                    span.title = 'Comment: ' + comment;
                    span.innerHTML = selection.toString();
                    selection.getRangeAt(0).deleteContents();
                    selection.getRangeAt(0).insertNode(span);
                }
            }
        }

        function trackChanges() {
            alert('Track Changes feature - Would track all edits in a real implementation');
        }

        // FIND/REPLACE
        function showFindReplace() {
            closeDialogs();
            document.getElementById('dialogOverlay').classList.add('show');
            document.getElementById('findDialog').classList.add('show');
            document.getElementById('findText').focus();
        }

        function closeFindReplace() {
            document.getElementById('dialogOverlay').classList.remove('show');
            document.getElementById('findDialog').classList.remove('show');
        }

        function closeDialogs() {
            document.getElementById('dialogOverlay').classList.remove('show');
            document.querySelectorAll('.dialog').forEach(d => d.classList.remove('show'));
        }

        function findNext() {
            const text = document.getElementById('findText').value;
            if (text) {
                window.find(text);
            }
        }

        function replaceAll() {
            const findText = document.getElementById('findText').value;
            const replaceText = document.getElementById('replaceText').value;
            
            if (findText) {
                getAllPageContents().forEach(page => {
                    const content = page.innerHTML;
                    page.innerHTML = content.replace(new RegExp(findText, 'g'), replaceText);
                });
                closeFindReplace();
            }
        }

        // FILE OPERATIONS
        function newDocument() {
            createNewTab();
        }

        function openDocument() {
            document.getElementById('fileInput').click();
        }

        function handleFileOpen(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const content = e.target.result;
                    
                    // Create new tab for opened file
                    const newDoc = {
                        id: nextDocumentId++,
                        title: file.name.replace(/\.[^/.]+$/, ''),
                        pages: [content]
                    };
                    
                    documents.push(newDoc);
                    
                    // Create tab
                    const tabsContainer = document.getElementById('tabsContainer');
                    const newTab = document.createElement('div');
                    newTab.className = 'doc-tab';
                    newTab.setAttribute('data-tab-id', newDoc.id);
                    newTab.setAttribute('onclick', `switchDocument(${newDoc.id})`);
                    newTab.innerHTML = `
                        <span class="tab-title">${newDoc.title}</span>
                        <span class="tab-close" onclick="closeTab(event, ${newDoc.id})">‚úï</span>
                    `;
                    
                    tabsContainer.appendChild(newTab);
                    
                    // Switch to new tab
                    loadDocument(newDoc.id);
                };
                reader.readAsText(file);
            }
            
            // Reset file input
            event.target.value = '';
        }

        function exportDocument() {
            const formats = `Choose export format:
1. HTML (.html) - Full formatting preserved
2. Plain Text (.txt) - For Windows Notepad
3. Word Document (.doc) - Compatible with Microsoft Word
4. PDF (via Print)

Enter 1, 2, 3, or 4:`;
            
            const format = prompt(formats, '1');
            
            if (format === '1') {
                exportAsHTML();
            } else if (format === '2') {
                exportAsText();
            } else if (format === '3') {
                exportAsDocx();
            } else if (format === '4') {
                window.print();
            }
        }

        function exportAsHTML() {
            let html = '<!DOCTYPE html><html><head><meta charset="UTF-8"><title>' + document.getElementById('docTitle').value + '</title>';
            html += '<style>body{font-family:Calibri,Arial;max-width:850px;margin:0 auto;padding:96px}.page{page-break-after:always;margin-bottom:30px}img{max-width:100%;height:auto}</style></head><body>';
            getAllPageContents().forEach((page, i) => {
                html += '<div class="page">' + page.innerHTML + '</div>';
            });
            html += '</body></html>';
            
            const blob = new Blob([html], { type: 'text/html' });
            downloadFile(blob, document.getElementById('docTitle').value + '.html');
        }

        function exportAsText() {
            let text = '';
            
            // Add document title
            text += document.getElementById('docTitle').value.toUpperCase() + '\r\n';
            text += '='.repeat(document.getElementById('docTitle').value.length) + '\r\n\r\n';
            
            // Add content from all pages
            getAllPageContents().forEach((page, index) => {
                // Get plain text from page
                const pageText = page.innerText || page.textContent || '';
                
                // Add page content
                text += pageText;
                
                // Add page separator if not the last page
                if (index < getAllPageContents().length - 1) {
                    text += '\r\n\r\n' + '-'.repeat(50) + '\r\n';
                    text += 'PAGE ' + (index + 2) + '\r\n';
                    text += '-'.repeat(50) + '\r\n\r\n';
                }
            });
            
            // Add footer with stats
            const words = text.trim().split(/\s+/).filter(w => w.length > 0).length;
            text += '\r\n\r\n' + '='.repeat(50) + '\r\n';
            text += 'Document Statistics\r\n';
            text += 'Total Pages: ' + getAllPageContents().length + '\r\n';
            text += 'Total Words: ' + words + '\r\n';
            text += 'Exported: ' + new Date().toLocaleString() + '\r\n';
            
            // Use Windows-style line endings (CRLF) for Notepad compatibility
            const blob = new Blob([text], { type: 'text/plain;charset=utf-8' });
            downloadFile(blob, document.getElementById('docTitle').value + '.txt');
            
            alert('Document exported as Plain Text (.txt)\n\nThis file will open perfectly in:\n‚Ä¢ Windows Notepad\n‚Ä¢ Any text editor\n‚Ä¢ Command line tools');
        }

        function exportAsDocx() {
            // Create a simple HTML structure that can be opened in Word
            let html = '<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:w="urn:schemas-microsoft-com:office:word" xmlns="http://www.w3.org/TR/REC-html40">';
            html += '<head><meta charset="utf-8"><title>' + document.getElementById('docTitle').value + '</title>';
            html += '<style>body{font-family:Calibri,Arial;font-size:11pt;line-height:1.6}@page{size:8.5in 11in;margin:1in}</style></head>';
            html += '<body>';
            
            getAllPageContents().forEach((page, i) => {
                if (i > 0) html += '<br clear=all style="page-break-before:always">';
                html += page.innerHTML;
            });
            
            html += '</body></html>';
            
            const blob = new Blob(['\ufeff', html], {
                type: 'application/msword'
            });
            downloadFile(blob, document.getElementById('docTitle').value + '.doc');
            
            alert('Document exported as .doc (Word 97-2003 format)\n\nThis file can be opened in Microsoft Word and saved as .docx if needed.');
        }

        function downloadFile(blob, filename) {
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // SETTINGS
        function showSettings() {
            closeDialogs();
            document.getElementById('dialogOverlay').classList.add('show');
            document.getElementById('settingsDialog').classList.add('show');
            
            // Load current settings
            document.getElementById('themeSelect').value = document.body.classList.contains('light-theme') ? 'light' : 'dark';
        }

        function closeSettings() {
            document.getElementById('dialogOverlay').classList.remove('show');
            document.getElementById('settingsDialog').classList.remove('show');
        }

        function toggleAutoSave() {
            const enabled = document.getElementById('autoSaveEnabled').checked;
            localStorage.setItem('autoSaveEnabled', enabled);
            alert(enabled ? 'Auto-save enabled' : 'Auto-save disabled');
        }

        function toggleSpellCheck() {
            const enabled = document.getElementById('spellCheckEnabled').checked;
            getAllPageContents().forEach(page => {
                page.setAttribute('spellcheck', enabled);
            });
        }

        function togglePageNumbers() {
            const enabled = document.getElementById('showPageNumbers').checked;
            document.querySelectorAll('.page-number').forEach(num => {
                num.style.display = enabled ? 'block' : 'none';
            });
        }

        function changeThemeFromSettings() {
            const theme = document.getElementById('themeSelect').value;
            if (theme === 'light') {
                document.body.classList.add('light-theme');
            } else {
                document.body.classList.remove('light-theme');
            }
            localStorage.setItem('theme', theme);
        }

        function showAbout() {
            const shortcuts = `NotePad - Professional Word Processor
Version 1.0

A full-featured document editor with:
‚Ä¢ Multi-tab document management
‚Ä¢ Rich text formatting
‚Ä¢ Image manipulation
‚Ä¢ Find & replace
‚Ä¢ Export to HTML, TXT, DOC, PDF
‚Ä¢ And much more!

Created with ‚ù§Ô∏è

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
‚å®Ô∏è  KEYBOARD SHORTCUTS
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

üìù TEXT FORMATTING:
   Ctrl+B - Bold
   Ctrl+I - Italic
   Ctrl+U - Underline
   Ctrl+Z - Undo
   Ctrl+Y - Redo

üìë TAB MANAGEMENT:
   Ctrl+N - New Tab
   Ctrl+W - Close Tab
   Ctrl+Tab - Next Tab
   Ctrl+Shift+Tab - Previous Tab

üìÅ FILE OPERATIONS:
   Ctrl+S - Save All Documents
   Ctrl+O - Open File
   Ctrl+E - Export Document
   Ctrl+P - Print

üîç OTHER:
   Ctrl+F - Find & Replace

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ`;
            
            alert(shortcuts);
        }

        function showKeyboardShortcuts() {
            showAbout();
        }

        // VIEW FEATURES
        function toggleTheme() {
            document.body.classList.toggle('light-theme');
            localStorage.setItem('theme', document.body.classList.contains('light-theme') ? 'light' : 'dark');
        }

        function updateZoom(value) {
            currentZoom = parseInt(value);
            const container = document.getElementById('pagesContainer');
            container.style.transform = `scale(${currentZoom / 100})`;
            container.style.transformOrigin = 'top center';
            document.getElementById('zoomLevel').textContent = currentZoom + '%';
        }

        function zoomIn() {
            const slider = document.getElementById('zoomSlider');
            const newValue = Math.min(200, currentZoom + 10);
            slider.value = newValue;
            updateZoom(newValue);
        }

        function zoomOut() {
            const slider = document.getElementById('zoomSlider');
            const newValue = Math.max(50, currentZoom - 10);
            slider.value = newValue;
            updateZoom(newValue);
        }

        function resetZoom() {
            document.getElementById('zoomSlider').value = 100;
            updateZoom(100);
        }

        function fullScreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
            } else {
                document.exitFullscreen();
            }
        }

        function readingMode() {
            document.querySelector('.top-bar').style.display = 'none';
            document.querySelector('.menu-bar').style.display = 'none';
            document.querySelector('.ribbon').style.display = 'none';
            alert('Reading Mode - Press ESC to exit');
            
            document.addEventListener('keydown', function exitReading(e) {
                if (e.key === 'Escape') {
                    document.querySelector('.top-bar').style.display = 'flex';
                    document.querySelector('.menu-bar').style.display = 'flex';
                    document.querySelector('.ribbon').style.display = 'block';
                    document.removeEventListener('keydown', exitReading);
                }
            });
        }

        // FILE OPERATIONS
        function updateDocTitle() {
            const title = document.getElementById('docTitle').value;
            document.title = title + ' - NotePad';
            debouncedAutoSave();
        }

        // Debounced auto-save to prevent excessive saves
        let autoSaveTimeout = null;
        function debouncedAutoSave() {
            if (autoSaveTimeout) {
                clearTimeout(autoSaveTimeout);
            }
            autoSaveTimeout = setTimeout(() => {
                saveAllDocuments();
            }, 500); // Save 500ms after last change
        }

        function autoSave() {
            debouncedAutoSave();
        }

        function showLogin() {
            alert('Login functionality - ready for implementation!');
        }

        // PAGE CONTENT LISTENERS - update to auto-save
        function setupPageListeners(pageContent) {
            // Check if listeners already attached to avoid duplicates
            if (pageContent.dataset.listenersAttached) return;
            pageContent.dataset.listenersAttached = 'true';
            
            pageContent.addEventListener('input', function() {
                updateWordCount();
                checkPageOverflow();
                updateButtons();
                debouncedAutoSave(); // Use debounced version
            });

            pageContent.addEventListener('mouseup', updateButtons);
            pageContent.addEventListener('keyup', updateButtons);
            
            pageContent.addEventListener('keydown', function(e) {
                if (e.key === 'Enter') {
                    setTimeout(() => checkPageOverflow(), 10);
                }
            });
        }

        // KEYBOARD SHORTCUTS
        document.addEventListener('keydown', function(e) {
            // Text formatting shortcuts
            if (e.ctrlKey || e.metaKey) {
                switch(e.key.toLowerCase()) {
                    case 'b':
                        e.preventDefault();
                        applyFormat('bold');
                        break;
                    case 'i':
                        e.preventDefault();
                        applyFormat('italic');
                        break;
                    case 'u':
                        e.preventDefault();
                        applyFormat('underline');
                        break;
                    case 's':
                        e.preventDefault();
                        saveAllDocuments();
                        alert('All documents saved! üíæ');
                        break;
                    case 'f':
                        e.preventDefault();
                        showFindReplace();
                        break;
                    case 'p':
                        e.preventDefault();
                        window.print();
                        break;
                    case 'z':
                        if (!e.shiftKey) {
                            e.preventDefault();
                            applyFormat('undo');
                        }
                        break;
                    case 'y':
                        e.preventDefault();
                        applyFormat('redo');
                        break;
                    case 'n':
                        // Ctrl+N - New tab
                        e.preventDefault();
                        createNewTab();
                        break;
                    case 'w':
                        // Ctrl+W - Close current tab
                        e.preventDefault();
                        const currentTab = document.querySelector(`.doc-tab[data-tab-id="${currentDocumentId}"]`);
                        if (currentTab) {
                            const closeEvent = new Event('click', { bubbles: true });
                            closeTab(closeEvent, currentDocumentId);
                        }
                        break;
                    case 'o':
                        // Ctrl+O - Open file
                        e.preventDefault();
                        openDocument();
                        break;
                    case 'e':
                        // Ctrl+E - Export
                        e.preventDefault();
                        exportDocument();
                        break;
                }
            }
            
            // Ctrl+Tab and Ctrl+Shift+Tab for tab switching
            if (e.ctrlKey && e.key === 'Tab') {
                e.preventDefault();
                switchToNextTab(!e.shiftKey);
            }
        });

        // Function to switch to next/previous tab
        function switchToNextTab(forward = true) {
            const currentIndex = documents.findIndex(doc => doc.id === currentDocumentId);
            let nextIndex;
            
            if (forward) {
                nextIndex = (currentIndex + 1) % documents.length;
            } else {
                nextIndex = currentIndex - 1;
                if (nextIndex < 0) nextIndex = documents.length - 1;
            }
            
            const nextDoc = documents[nextIndex];
            if (nextDoc) {
                loadDocument(nextDoc.id);
            }
        }

        // INITIALIZATION
        window.addEventListener('load', function() {
            // Load all documents from localStorage
            loadAllDocuments();
            
            // If no documents were loaded, ensure we have the default one
            if (documents.length === 0) {
                const firstPage = document.querySelector('.page-content');
                if (firstPage) {
                    setupPageListeners(firstPage);
                }
            }
            
            updateWordCount();
            updatePageCount();
            
            // Load theme
            if (localStorage.getItem('theme') === 'light') {
                document.body.classList.add('light-theme');
            }
            
            console.log('NotePad initialized with tab system');
        });
    </script>
</body>
</html>
